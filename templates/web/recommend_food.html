<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å¤–å–æ¨è - DietCat</title>
    <style>
        .recommendation-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .recommendation-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .food-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .food-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .food-shop {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .food-name {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }
        .food-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.2em;
        }
        .food-rating {
            color: #f39c12;
            margin: 5px 0;
        }
        .food-category {
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            color: #666;
        }
        .recommendation-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .refresh-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    {% include 'web/header.html' %}
    
    <div class="recommendation-container">
        <div class="recommendation-header">
            <h1>ğŸ± æ™ºèƒ½å¤–å–æ¨è</h1>
            <p>åŸºäºæ‚¨çš„åå¥½å’Œå¥åº·æ•°æ®ç²¾å¿ƒæŒ‘é€‰</p>
        </div>

        {% if error_message %}
        <div style="background: #ffeaa7; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
            {{ error_message }}
        </div>
        {% endif %}

        <div class="recommendation-stats">
            <p>ğŸ“Š ä¸ºæ‚¨æ¨èäº† <strong>{{ total_count }}</strong> ä¸ªèœå“</p>
            {% if user and user.eating_prefer %}
            <p>ğŸ¯ æ ¹æ®æ‚¨çš„åå¥½ï¼š<strong>{{ user.eating_prefer }}</strong></p>
            {% endif %}
        </div>

        <button class="refresh-btn" onclick="refreshRecommendations()">
            ğŸ”„ æ¢ä¸€æ‰¹æ¨è
        </button>

        <div class="food-grid">
            {% for food in recommendations %}
            <div class="food-card">
                <div class="food-shop">{{ food.å•†é“ºåç§° }}</div>
                <div class="food-name">{{ food.èœå“ }}</div>
                
                <div class="food-rating">
                    â­ {{ food.average_rating|default:food.è¯„åˆ†|default:4.0 }} 
                    {% if food.rating_count %}
                    <small>({{ food.rating_count }}è¯„ä»·)</small>
                    {% endif %}
                </div>
                
                <div class="food-price">Â¥{{ food.ä»·æ ¼|default:"æœªçŸ¥" }}</div>
                
                {% if food.åˆ†ç±» %}
                <div class="food-category">{{ food.åˆ†ç±» }}</div>
                {% endif %}
                
                {% if food.å¡è·¯é‡Œ %}
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                    çƒ­é‡: {{ food.å¡è·¯é‡Œ }}å¡
                </div>
                {% endif %}
                
                {% if food.è›‹ç™½è´¨ %}
                <div style="font-size: 0.9em; color: #666;">
                    è›‹ç™½è´¨: {{ food.è›‹ç™½è´¨ }}g
                </div>
                {% endif %}
            </div>
            {% empty %}
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <h3>æš‚æ— æ¨èèœå“</h3>
                <p>è¯·æ£€æŸ¥æ•°æ®åº“è¿æ¥æˆ–ç¨åé‡è¯•</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function refreshRecommendations() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const btn = event.target;
            btn.innerHTML = 'ğŸ”„ æ¨èä¸­...';
            btn.disabled = true;
            
            // é‡æ–°åŠ è½½é¡µé¢
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¨èç†ç”±
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ¨èé¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>