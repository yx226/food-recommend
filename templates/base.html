<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <!-- åŸºç¡€PWAé…ç½® -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1abc9c"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="é¥­ç‚¹å­">
    <link rel="apple-touch-icon" href="/static/icons/icon-152x152.png">

    <!-- ä½¿ç”¨å…¼å®¹çš„jQueryç‰ˆæœ¬ -->
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

    <!-- Bootstrap4 CSS -->
    <link href="{% static "/flatui/dist/css/vendor/bootstrap.min.css" %}" rel="stylesheet">
    <link href="{% static "/flatui/dist/css/flat-ui.css" %}" rel="stylesheet">

    <!-- å›¾æ ‡ -->
    <link rel="shortcut icon" href="{% static "/flatui/dist/favicon.ico" %}">

    <!-- Vue -->
    <script src="{% static "/vue/js/vue.min.js" %}"></script>

    <title>{% block title %}é»˜è®¤æ ‡é¢˜{% endblock %}-é¥­ç‚¹å­</title>

    <!-- Echarts -->
    <script type="text/javascript" src="{% static "/echarts/echarts.min.js" %}"></script>

    <!-- å­ç±»HTMLè‡ªå·±è¦å¼•å…¥çš„ä¾èµ– -->
    {% block own-rely %}
    {% endblock %}
</head>
<body>
{# å¼•å…¥å¯¼èˆªæ¡ #}
{% include 'nav.html' %}

{# é»˜è®¤å†…å®¹åŒºåŸŸ #}
{% block content %}
    <div>
        è¿™é‡Œæ˜¯é»˜è®¤å†…å®¹
    </div>
{% endblock %}

{# å¼•å…¥å°¾æ ‡ #}
{% include 'bottom.html' %}

<!-- å¿…è¦çš„JavaScript -->
<script src="{% static "/flatui/other_rely/video.js" %}"></script>
<script src="{% static "/flatui/dist/scripts/flat-ui.js" %}"></script>

<!-- ç®€åŒ–çš„PWAå®‰è£…å¼•å¯¼ -->
<script>
// ç«‹å³æ˜¾ç¤ºå®‰è£…å¼•å¯¼æŒ‰é’®
setTimeout(() => {
    showInstallGuide();
}, 3000);

function showInstallGuide() {
    if (!document.getElementById('install-guide-btn')) {
        const guideBtn = document.createElement('button');
        guideBtn.id = 'install-guide-btn';
        guideBtn.innerHTML = 'ğŸ“± å®‰è£…åˆ°æ‰‹æœº';
        guideBtn.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(26, 188, 156, 0.4);
            z-index: 1000;
            font-size: 16px;
            transition: all 0.3s ease;
        `;
        
        guideBtn.addEventListener('click', showInstallInstructions);
        document.body.appendChild(guideBtn);
        console.log('âœ… å®‰è£…å¼•å¯¼æŒ‰é’®å·²æ˜¾ç¤º');
    }
}

function showInstallInstructions() {
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);
    const isChrome = /Chrome/.test(navigator.userAgent);
    const isSafari = /Safari/.test(navigator.userAgent);
    
    let instructions = 'ğŸ“± å¦‚ä½•å®‰è£…"é¥­ç‚¹å­"åˆ°æ‰‹æœºï¼š\n\n';
    
    if (isIOS) {
        instructions += 'ğŸ iPhoneç”¨æˆ·ï¼š\n';
        instructions += '1. ç‚¹å‡»åº•éƒ¨åˆ†äº«æŒ‰é’® (â¬†ï¸)\n';
        instructions += '2. å‘ä¸‹æ»‘åŠ¨æ‰¾åˆ°"æ·»åŠ åˆ°ä¸»å±å¹•"\n';
        instructions += '3. ç‚¹å‡»"æ·»åŠ "å®Œæˆå®‰è£…\n\n';
        instructions += 'ğŸ’¡ æç¤ºï¼šä½¿ç”¨Safariæµè§ˆå™¨æ•ˆæœæœ€ä½³';
    } else if (isAndroid) {
        instructions += 'ğŸ¤– Androidç”¨æˆ·ï¼š\n';
        if (isChrome) {
            instructions += '1. ç‚¹å‡»å³ä¸Šè§’èœå• (â‹®)\n';
            instructions += '2. ç‚¹å‡»"æ·»åŠ åˆ°ä¸»å±å¹•"\n';
            instructions += '3. ç‚¹å‡»"æ·»åŠ "å®Œæˆå®‰è£…\n\n';
            instructions += 'ğŸ’¡ æç¤ºï¼šä½¿ç”¨Chromeæµè§ˆå™¨æ•ˆæœæœ€ä½³';
        } else {
            instructions += '1. ç‚¹å‡»æµè§ˆå™¨èœå•æŒ‰é’®\n';
            instructions += '2. æŸ¥æ‰¾"æ·»åŠ åˆ°ä¸»å±å¹•"é€‰é¡¹\n';
            instructions += '3. æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…';
        }
    } else {
        instructions += 'ğŸ’» æ¡Œé¢ç”¨æˆ·ï¼š\n';
        instructions += '1. åœ¨åœ°å€æ æŸ¥æ‰¾ä¸‹è½½å›¾æ ‡ (â¬‡ï¸)\n';
        instructions += '2. æˆ–ç­‰å¾…æµè§ˆå™¨å¼¹å‡ºå®‰è£…æç¤º\n';
        instructions += '3. ç‚¹å‡»å®‰è£…å³å¯\n\n';
        instructions += 'ğŸ“± å»ºè®®ä½¿ç”¨æ‰‹æœºè®¿é—®ä»¥è·å¾—æœ€ä½³ä½“éªŒ';
    }
    
    instructions += '\n\nğŸ”§ å¦‚æœçœ‹ä¸åˆ°é€‰é¡¹ï¼š\n';
    instructions += 'â€¢ åˆ·æ–°é¡µé¢ç­‰å¾…30ç§’\n';
    instructions += 'â€¢ ä½¿ç”¨æœ€æ–°ç‰ˆChromeæˆ–Safari\n';
    instructions += 'â€¢ ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š';
    
    if (confirm(instructions + '\n\nç‚¹å‡»"ç¡®å®š"æŸ¥çœ‹è¯¦ç»†æ­¥éª¤ï¼Œç‚¹å‡»"å–æ¶ˆ"å…³é—­')) {
        // æ˜¾ç¤ºæ›´è¯¦ç»†çš„æ­¥éª¤
        showDetailedSteps();
    }
}

function showDetailedSteps() {
    const detailedHTML = `
        <div style="
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        ">
            <h3 style="color: #1abc9c; margin-top: 0;">ğŸ“± å®‰è£…"é¥­ç‚¹å­"è¯¦ç»†æ­¥éª¤</h3>
            
            <div style="margin: 20px 0;">
                <h4>ğŸ iPhoneç”¨æˆ· (Safariæµè§ˆå™¨)ï¼š</h4>
                <ol>
                    <li>ç‚¹å‡»åº•éƒ¨ <strong>åˆ†äº«æŒ‰é’®</strong> (â¬†ï¸ å›¾æ ‡)</li>
                    <li>å‘ä¸‹æ»‘åŠ¨æ‰¾åˆ° <strong>"æ·»åŠ åˆ°ä¸»å±å¹•"</strong></li>
                    <li>ç‚¹å‡» <strong>"æ·»åŠ "</strong> æŒ‰é’®</li>
                    <li>æ¡Œé¢ä¼šå‡ºç°"é¥­ç‚¹å­"å›¾æ ‡</li>
                </ol>
            </div>
            
            <div style="margin: 20px 0;">
                <h4>ğŸ¤– Androidç”¨æˆ· (Chromeæµè§ˆå™¨)ï¼š</h4>
                <ol>
                    <li>ç‚¹å‡»å³ä¸Šè§’ <strong>èœå•æŒ‰é’®</strong> (â‹® ä¸‰ä¸ªç‚¹)</li>
                    <li>é€‰æ‹© <strong>"æ·»åŠ åˆ°ä¸»å±å¹•"</strong></li>
                    <li>ç‚¹å‡» <strong>"æ·»åŠ "</strong> æŒ‰é’®</li>
                    <li>æ¡Œé¢ä¼šå‡ºç°"é¥­ç‚¹å­"å›¾æ ‡</li>
                </ol>
            </div>
            
            <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <h4>ğŸ’¡ å®‰è£…åä½“éªŒï¼š</h4>
                <ul>
                    <li>ğŸ“± åƒåŸç”ŸAPPä¸€æ ·å…¨å±è¿è¡Œ</li>
                    <li>âš¡ å¿«é€Ÿå¯åŠ¨ï¼Œæ— éœ€æ‰“å¼€æµè§ˆå™¨</li>
                    <li>ğŸ”” æ”¯æŒæ¨é€é€šçŸ¥ï¼ˆå¦‚é…ç½®ï¼‰</li>
                    <li>ğŸ’¾ å¯ç¦»çº¿ä½¿ç”¨éƒ¨åˆ†åŠŸèƒ½</li>
                </ul>
            </div>
            
            <button onclick="this.parentElement.remove()" style="
                background: #1abc9c;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 20px;
                cursor: pointer;
                font-weight: bold;
                margin-top: 15px;
            ">å…³é—­è¯´æ˜</button>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', detailedHTML);
}

// ç®€åŒ–çš„Service Workerå°è¯•ï¼ˆä¸å¼ºåˆ¶ï¼‰
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('{% static "sw.js" %}')
        .then(reg => console.log('Service Workeræ³¨å†Œå°è¯•'))
        .catch(err => console.log('Service Workeræ³¨å†Œè·³è¿‡'));
}

console.log('ğŸ¯ é¥­ç‚¹å­PWAå¼•å¯¼å·²åŠ è½½');
console.log('ğŸ’¡ æç¤ºï¼šå¼€å‘ç¯å¢ƒPWAåŠŸèƒ½å¯èƒ½å—é™ï¼Œç”Ÿäº§ç¯å¢ƒæ›´ç¨³å®š');
</script>
</body>
</html>